'use strict';(function(a){var h={initialize:function(){a(".erp-hr-leave-policy").on("click","a.submitdelete",this,this.policy.remove);a("body").on("change","#erp-hr-leave-req-from-date, #erp-hr-leave-req-to-date",this,this.leave.requestDates);this.leave.setPolicy();a("body").on("change","#erp-hr-leave-req-employee-id",this,this.leave.setPolicy);a("body").on("change",".new-leave-request-form .f_year, .erp-hr-leave-request-new .f_year",this,this.leave.setPolicy);a("body").on("change","#erp-hr-leave-req-leave-policy",
this,this.leave.setAvailableDays);a(".hrm-dashboard").on("click",".erp-hr-new-leave-request-wrap a#erp-hr-new-leave-req",this.leave.takeLeave);a(".erp-employee-single").on("submit","form#erp-hr-empl-leave-history",this.leave.showHistory);a(".entitlement-list-table").on("click","a.submitdelete",this,this.entitlement.remove);a(".erp-hr-holiday-wrap").on("click","a#erp-hr-new-holiday",this,this.holiday.create);a(".erp-hr-holiday-wrap").on("click",".erp-hr-holiday-edit",this,this.holiday.edit);a(".erp-hr-holiday-wrap").on("click",
".erp-hr-holiday-delete",this,this.holiday.remove);a(".erp-hr-holiday-wrap").on("click","a#erp-hr-import-holiday",this,this.holiday.import);a("body").on("change",".erp-hr-holiday-date-range",this,this.holiday.checkRange);a("body").on("dblclick","#erp-hr-holiday-data input",function(){a(this).removeAttr("readonly");a(this).removeAttr("onfocus")});a("body").on("click","#erp-hr-import-ical",this,this.importICalInit);a(".erp-hr-holiday-wrap").on("change","#erp-ical-input",this,this.uploadICal);a(".erp-hr-leave-requests").on("click",
".erp-hr-leave-approve-btn",this,this.leave.approve);a(".erp-hr-leave-requests").on("click",".erp-hr-leave-reject-btn",this,this.leave.reject);a(".request-list-table").on("click","a.submitdelete",this,this.leave.remove);a("#filter_year").on("change",this,this.customFilterLeaveReport);a('input[name="end"], input[name="start"]').on("change",this,this.checkDateRange);a(".leave-entitlement-form").on("change","#assignment_to",this,this.entitlement.hideEmployee);a(".leave-entitlement-form#assignment_to").change();
this.entitlement.getLeavePolicies();a(".leave-entitlement-form").on("change",".change_policy",this,this.entitlement.getLeavePolicies);a(".leave-entitlement-form").on("change","#leave_policy",this,this.entitlement.getFilteredEmployee);this.initDateField()},initToggleCheckbox:function(){var b=!1;a("tbody").children().children(".check-column").find(":checkbox").click(function(c){if("undefined"==c.shiftKey)return!0;if(c.shiftKey){if(!b)return!0;checks=a(b).closest("form").find(":checkbox").filter(":visible:enabled");
first=checks.index(b);last=checks.index(this);checked=a(this).prop("checked");0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return a(this).closest("tr").is(":visible")?checked:!1}))}b=this;var d=a(this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");a(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===d.length});return!0});a("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",
function(c){var d=a(this),e=d.closest("table"),f=d.prop("checked"),g=c.shiftKey||d.data("wp-toggle");e.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return a(this).is(":hidden,:disabled")?!1:g?!a(this).prop("checked"):f?!0:!1});e.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!g&&f?!0:!1})})},initDateField:function(){a(".erp-leave-date-field").datepicker({dateFormat:"yy-mm-dd",
changeMonth:!0,changeYear:!0});a(".erp-leave-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-date-picker-to").datepicker("option","minDate",b)}});a(".erp-leave-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-date-picker-from").datepicker("option","maxDate",b)}});a(".erp-leave-datetime-picker-from").datetimepicker({dateFormat:"yy-mm-dd",
timeFormat:"HH:mm:ss",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-datetime-picker-to").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,minDate:b});b=a(this).parent().parent().data("id");var c=new Date(a(this).val().trim()),d=new Date(a(this).closest("td").next("td").find("input").val().trim());c=Math.round((d-c)/1E3/3600/24);d=1<c?" days":" day";a("#duration-"+b).html(c+d)}});a(".erp-leave-datetime-picker-to").datetimepicker({dateFormat:"yy-mm-dd",
timeFormat:"HH:mm:ss",timeInput:!0,changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-datetime-picker-from").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,maxDate:b});b=a(this).parent().parent().data("id");var c=new Date(a(this).val().trim()),d=new Date(a(this).closest("td").prev("td").find("input").val().trim());c=Math.round((c-d)/1E3/3600/24);d=1<c?" days":" day";a("#duration-"+b).html(c+d)}});a(".erp-color-picker").wpColorPicker()},holiday:{checkRange:function(){a('input[name="range"]').is(":checked")?
a('input[name="end_date"]').closest(".row").show():a('input[name="end_date"]').closest(".row").hide()},create:function(b){b.preventDefault();a.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_create,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){h.initDateField();h.holiday.checkRange();h.initToggleCheckbox()},onSubmit:function(c){b.data.holiday.submit.call(this,c)}})},edit:function(b){b.preventDefault();
var c=a(this);a.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_update,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){h.initDateField();h.holiday.checkRange();var d=this;a("header",d).after(a('<div class="loader"></div>').show());wp.ajax.send("erp-hr-get-holiday",{data:{id:c.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){a(".loader",d).remove();e=e.holiday;a("#erp-hr-holiday-title",
d).val(e.title);a("#erp-hr-holiday-start",d).val(e.start);a("#erp-hr-holiday-end",d).val(e.end);a("#erp-hr-holiday-id",d).val(e.id);a("#erp-hr-holiday-description",d).val(e.description);a("#erp-hr-holiday-action",d).val("erp_hr_holiday_create");var f=new Date(e.start);e=Math.abs((new Date(e.end)).getTime()-f.getTime());0<Math.ceil(e/864E5)&&(a("#erp-hr-holiday-range").attr("checked","checked"),a("#erp-hr-holiday-range").trigger("change"))}})},onSubmit:function(d){b.data.holiday.submit.call(this,d)}})},
remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmHoliday)&&wp.ajax.send("erp-hr-holiday-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(d){alert(d)}})},submit:function(b){wp.ajax.send({data:this.serializeObject(),success:function(c){b.closeModal();a(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){h.initDateField();h.initToggleCheckbox();a("#holiday_msg").html(c)})},
error:function(c){b.enableButton();b.showError(c)}})},import:function(b){b.preventDefault();a.erpPopup({title:wpErpHr.popup.holiday_import,button:wpErpHr.popup.import,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-import")({data:null}).trim(),extraClass:"small",onReady:function(){h.initDateField();h.holiday.checkRange()},onSubmit:function(c){b.data.holiday.submit.call(this,c)}})}},policy:{remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmPolicy)&&
wp.ajax.send("erp-hr-leave-policy-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(d){alert(d)}})}},entitlement:{remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmEntitlement)&&wp.ajax.send("erp-hr-leave-entitlement-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id"),user_id:c.data("user_id"),policy_id:c.data("policy_id")},success:function(){c.closest("tr").fadeOut("fast",
function(){a(this).remove()})},error:function(d){alert(d)}})},hideEmployee:function(b){b.preventDefault();a(this).is(":checked")?a(".single_employee_field").hide():a(".single_employee_field").show()},getLeavePolicies:function(){a(".leave-entitlement-form .leave_policy").find("option").remove();a(".leave-entitlement-form .leave_policy").prop("disabled",!0);var b=a(".leave-entitlement-form .department_id").select2("data"),c=a(".leave-entitlement-form .designation_id").select2("data"),d=a(".leave-entitlement-form .location_id").select2("data"),
e=a(".leave-entitlement-form .gender").select2("data"),f=a(".leave-entitlement-form .marital").select2("data"),g=a(".leave-entitlement-form .f_year").select2("data"),k=a(".leave-entitlement-form .employee_type").select2("data");"undefined"!==typeof g&&""!=g[0].id&&wp.ajax.send("erp-hr-leave-get-policies",{data:{_wpnonce:wpErpHr.nonce,employee_type:k[0].id,department_id:b[0].id,designation_id:c[0].id,location_id:d[0].id,gender:e[0].id,marital:f[0].id,f_year:g[0].id},success:function(m){var l=a(".leave-entitlement-form .leave_policy");
l.find("option").remove();a.each(m,function(n,p){n=new Option(p,n);l.append(n)});l.trigger("change");l.prop("disabled",!1)},error:function(m){console.log(m)}})},getFilteredEmployee:function(){var b=a(".leave-entitlement-form #leave_policy").val();a(".leave-entitlement-form .single_employee").prop("disabled",!0);"undefined"!==typeof b&&0!=b&&""!=b&&wp.ajax.send("erp-hr-leave-get-employees",{data:{_wpnonce:wpErpHr.nonce,policy_id:b},success:function(c){var d=a(".leave-entitlement-form .single_employee");
d.find("option").remove();a.each(c,function(e,f){e=new Option(f,e);d.append(e)});d.trigger("change");d.prop("disabled",!1)},error:function(c){console.log(c)}})}},leave:{takeLeave:function(b){b.preventDefault();a.erpPopup({title:wpErpHr.popup.new_leave_req,button:wpErpHr.popup.take_leave,id:"erp-hr-new-leave-req-popup",content:wp.template("erp-new-leave-req")().trim(),extraClass:"medium",onReady:function(){h.initDateField()},onSubmit:function(c){a("button[type=submit]",".erp-modal").attr("disabled",
"disabled");var d=a("#erp-hr-new-leave-req-popup .erp-modal-form")[0];d=new FormData(d);a.ajax({type:"POST",enctype:"multipart/form-data",url:ajaxurl,data:d,processData:!1,contentType:!1,cache:!1,timeout:6E5,success:function(e){c.enableButton();alert(e.data);c.closeModal()},error:function(e){c.enableButton();c.showError(e)}})}});h.leave.setPolicy()},requestDates:function(b){var c=a("#erp-hr-leave-req-from-date").val(),d=a("#erp-hr-leave-req-to-date").val(),e=a(this).closest("form").find('*[type="submit"]'),
f=parseInt(a("#erp-hr-leave-req-employee-id").val()),g=a("#erp-hr-leave-req-leave-policy").val(),k=a("#halfday"),m=!1;if("undefined"!==k.val()&&k.is(":checked")&&(m=!0,"leave_to"===b.target.name))return;""!==c&&""!==d&&wp.ajax.send("erp-hr-leave-request-req-date",{data:{_wpnonce:wpErpHr.nonce,from:c,to:d,employee_id:f,type:g},success:function(l){var n=wp.template("erp-leave-days")(l.print);!0===m&&"0"!=l.leave_count&&(n="");a("div.erp-hr-leave-req-show-days").html(n);0>=parseInt(l.leave_count)?e.prop("disabled",
!0):e.prop("disabled",!1)},error:function(l){a("div.erp-hr-leave-req-show-days").empty();e.attr("disabled","disable");"undefined"!==typeof l&&alert(l)}})},setPolicy:function(){h.leave.resetDateRange();a(this);var b=a("div.erp-hr-leave-reqs-wrap"),c=b.find(".erp-hr-leave-type-wrapper");c.html("");if(0!=a("#erp-hr-leave-req-employee-id").val()){var d=a(".f_year").val();0!=d&&void 0!==d&&wp.ajax.send("erp-hr-leave-employee-assign-policies",{data:{_wpnonce:wpErpHr.nonce,employee_id:a("#erp-hr-leave-req-employee-id").val(),
f_year:d},success:function(e){c.html(e).hide().fadeIn();b.find('input[type="text"], textarea').removeAttr("disabled")},error:function(e){c.html('<div class="notice error"><p>'+e+"</p></div>").hide().fadeIn()}})}},setAvailableDays:function(){h.leave.resetDateRange();var b=a(this);wp.ajax.send("erp-hr-leave-policies-availablity",{data:{_wpnonce:wpErpHr.nonce,employee_id:a("#erp-hr-leave-req-employee-id").val(),policy_id:b.val()},success:function(c){b.closest("div.row").find("span.description").remove();
a(c).insertAfter(b)},error:function(c){alert(c)}})},resetDateRange:function(){a("#erp-hr-leave-req-from-date").val("");a("#erp-hr-leave-req-to-date").val("");a("div.erp-hr-leave-req-show-days").html("")},showHistory:function(b){b.preventDefault();b=a(this);wp.ajax.send("erp-hr-empl-leave-history",{data:b.serializeObject(),success:function(c){a("table#erp-hr-empl-leave-history-table tbody").html(c)}})},approve:function(b){b.preventDefault();b={id:a(this).data("id")};a.erpPopup({title:wpErpHr.popup.leave_approve,
button:wpErpHr.popup.leave_approve_btn,id:"erp-hr-leave-approve-popup",content:wperp.template("erp-hr-leave-approve-js-tmp")(b).trim(),extraClass:"smaller",onSubmit:function(c){wp.ajax.send({data:this.serialize()+"&_wpnonce="+wpErpHr.nonce,success:function(d){var e="";if(d.errors)a.each(d.errors,function(g,k){e+='<div class="notice notice-error is-dismissible"><p>'+k[0]+"</p></div>"}),""!=e&&a("#leave-approve-form-error").html(e);else{if(d.redirect){var f=window.location.origin+window.location.pathname+
"?1=1";a.each(d.redirect,function(g,k){f+="&"+g+"="+k})}else f=window.location.origin+window.location.pathname+"?page=erp-hr&section=leave&status=1";window.location.replace(f)}},error:function(d){c.showError(d)}})}})},reject:function(b){b.preventDefault();b={id:a(this).data("id")};a.erpPopup({title:wpErpHr.popup.leave_reject,button:wpErpHr.popup.leave_reject_btn,id:"erp-hr-leave-reject-popup",content:wperp.template("erp-hr-leave-reject-js-tmp")(b).trim(),extraClass:"smaller",onSubmit:function(c){wp.ajax.send({data:this.serialize()+
"&_wpnonce="+wpErpHr.nonce,success:function(d){var e="";if(d.errors)a.each(d.errors,function(g,k){e+='<div class="notice notice-error is-dismissible"><p>'+k[0]+"</p></div>"}),""!=e&&a("#leave-reject-form-error").html(e);else{if(d.redirect){var f=window.location.origin+window.location.pathname+"?1=1";a.each(d.redirect,function(g,k){f+="&"+g+"="+k})}else f=window.location.origin+window.location.pathname+"?page=erp-hr&section=leave&status=3";window.location.replace(f)}},error:function(d){c.showError(d)}})}})},
remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmRequest)&&wp.ajax.send("erp-hr-leave-request-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(d){alert(d)}})}},importICalInit:function(b){b.preventDefault();a("body #erp-ical-input").trigger("click")},uploadICal:function(b){b.preventDefault();b=b.target.files[0];var c=new FormData,d=a(this).parents("form");c.append("ics",
b);c.append("action","erp-hr-import-ical");c.append("_wpnonce",wpErpHr.nonce);wp.ajax.send({data:c,cache:!1,processData:!1,contentType:!1,beforeSend:function(){a("#erp-holiday-uploading").show()},success:function(e){var f="";e&&e.length&&"object"===typeof e?(e.forEach(function(g,k){f+='<tr data-id="'+k+'"><td><input readonly onfocus="this.blur()" type="text" name="title[]" value="'+g.title+'"/></td><td><input readonly onfocus="this.blur()" type="text" name="start[]" class="erp-leave-datetime-picker-from" value="'+
g.start+'"/></td><td><input readonly onfocus="this.blur()" type="text" name="end[]" class="erp-leave-datetime-picker-to" value="'+g.end+'"/></td><td id="duration-'+k+'">'+g.duration+'</td></tr><input type="hidden" name="description[]" value="'+g.description+'"/>'}),a("#holiday-import-hint").html("** "+wpErpHr.import_hint),a("#erp-hr-holiday-data thead").show()):(f+='<tr><td colspan="4">'+e+"</td></tr>",a("#holiday-import-hint").html(""),a("#erp-hr-holiday-data thead").hide());a("#erp-hr-holiday-data tbody").html(f);
h.initDateField();d[0].reset();a("#erp-holiday-uploading").hide()},error:function(e){d[0].reset();alert(e);a("#erp-holiday-uploading").hide()}})},customFilterLeaveReport:function(){"custom"!=this.value?a("#custom-input").remove():a("#custom-date-range").after('<span id="custom-input" style="float:left"><span>From </span><input name="start" class="erp-leave-date-field" type="text">&nbsp;<span>To </span><input name="end" class="erp-leave-date-field" type="text"></span>');h.initDateField()},checkDateRange:function(){var b=
(new Date(this.value)).getFullYear(),c=(new Date).getFullYear();b>c&&(alert("Enter date range between current year"),this.value="")}};a(function(){h.initialize()})})(jQuery);